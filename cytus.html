<html>
<head>
    <title>cytus</title>
</head>
    <link rel="stylesheet" type="text/css" href="/cytus/static/cytus.css">
<body>
    <input type="file" id="file" onchange="getfile(event)"><br>
    <input id="ps"><input type="button" id="sub"><br><br>


    <select id="which">
        <option id="headopt">choose which</option>
    </select>
    <select id="mod">
    <option id="showall">show all</option>
        <option id="diff">diff</option>
    </select>

    <input type="button" id="update">

    <div id="showps" class="ps"></div>
    <table id="here"></table>

</body>
</html>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

<script src="/cytus/static/makeallAppend.js"></script>
<script src="/cytus/static/makeDiff.js"></script>
<script>
    var socket = io("http://weak.infor.org");

    var content;
    function getfile(event){
        var file = event.target.files[0];
        var r = new FileReader();
        r.onload = function(event){
            content = event.target.result;
        }
        r.readAsText(file);
    }

    document.getElementById('sub').onclick = function(){
        var ps = document.getElementById('ps').value;
        console.log(content)
        if(content!=undefined){
            socket.emit('xml',content,ps);
        }
    }

    socket.emit('give all');
    socket.on('this is all',function(all){
        console.log(all);
        for(var i=0;i<all.length;i++){
            $('#headopt').after("<option value='"+i+"'>"+(all[i]["time"])+"</option>");
        }


        document.getElementById('update').onclick = function(){
            var choosed = document.getElementById('which').value;
            var mod = document.getElementById('mod').value;

            var append = "";
            var mainobj = all[choosed];
            if(mod=="show all"){
                viewthis = all[choosed];
                console.log(viewthis);
                
                append = makeallAppend(viewthis);
            }
            if(mod=="diff"){
                var comp = [all[choosed-1],all[choosed]];
                console.log(comp);

                append = makeDiff(comp);
            }
            $('#here').empty();
            $('#here').append(append);

            $('#showps').empty();
            $('#showps').append(mainobj["ps"]);
        }
    })

</script>
